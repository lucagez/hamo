!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){var e=function(e){void 0===e&&(e=[]);for(var n=[],t=arguments.length-1;t-- >0;)n[t]=arguments[t+1];for(var u=e.length,r=0;r<u;r++)e[r].apply(e,n)};function n(e,n){this.queues[e]=(this.queues[e]||[]).concat([n]),this.handler=this.build()}function t(e){this.queues[e]=void 0,this.handler=this.build()}function u(){var e=this.queues,n=e.before,t=e.oncebefore,u=e.after,r=e.onceafter,s=t||n||u||r,i="";return t&&(i+="this.every(this.queues.oncebefore, ...arguments);",i+="this.queues.oncebefore = undefined;"),n&&(i+="this.every(this.queues.before, ...arguments);"),s&&(i+="const result = this.func(...arguments);"),(u||r)&&(i+="Promise.resolve().then(() => {",r&&(i+="this.every(this.queues.onceafter, result, ...arguments);",i+="this.queues.onceafter = undefined;"),u&&(i+="this.every(this.queues.after, result, ...arguments);"),i+="});"),s&&(i+="return result;"),i.length>0?new Function(i):this.func}module.exports=function(r){var s={queues:{},func:r,handler:r,build:u,every:e};return[function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return s.handler.apply(s,e)},n.bind(s),t.bind(s)]}});
